#!/bin/bash

# Verifica se gum estÃ¡ instalado
if ! command -v gum &> /dev/null; then
    echo "âŒ gum nÃ£o encontrado. Instale com: brew install gum (ou veja no GitHub)."
    exit 1
fi

# Menu multi-seleÃ§Ã£o
opcoes=$(gum choose --no-limit "Stop Containers" "Containers" "Imagens" "Volumes" "Networks" "Tudo")

# Executa de acordo com as escolhas
for opcao in $opcoes; do
    case $opcao in
        "Stop Containers")
            echo "ğŸ›‘ Parando todos os containers em execuÃ§Ã£o..."
            docker stop $(docker ps -q) 2>/dev/null || echo "Nenhum container em execuÃ§Ã£o."
            ;;
        "Containers")
            echo "ğŸ§¹ Limpando containers..."
            docker container prune -f
            ;;
        "Imagens")
            echo "ğŸ§¹ Limpando imagens..."
            docker image prune -a -f
            ;;
        "Volumes")
            echo "ğŸ§¹ Limpando volumes..."
            # ForÃ§a remoÃ§Ã£o de volumes que nÃ£o estÃ£o em uso
            docker volume prune -f
            # Remove volumes Ã³rfÃ£os de containers removidos
            docker volume ls -qf dangling=true | xargs -r docker volume rm
            ;;
        "Networks")
            echo "ğŸ§¹ Limpando redes..."
            docker network prune -f
            ;;
        "Tudo")
            echo "ğŸ§¹ Limpando TUDO (containers, imagens, volumes e redes)..."
            docker system prune -a --volumes -f
            ;;
    esac
done

